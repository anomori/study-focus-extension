<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title data-i18n="settings_title">🎯 詳細設定 - Study Focus Guard</title>
    <link rel="stylesheet" href="settings.css">
</head>

<body>
    <div class="settings-container">
        <header class="header">
            <h1 data-i18n="settings_title">🎯 詳細設定</h1>
            <p class="subtitle">Study Focus Guard</p>
        </header>

        <!-- タブナビゲーション -->
        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="statistics" data-i18n="tab_statistics">📊 統計</button>
            <button class="tab-btn" data-tab="sites" data-i18n="tab_sites">🌐 サイト設定</button>
            <button class="tab-btn" data-tab="advanced" data-i18n="tab_advanced">⚙️ 詳細設定</button>
            <button class="tab-btn" data-tab="data" data-i18n="tab_data">🗑️ データ管理</button>
        </nav>

        <!-- 統計タブ -->
        <section id="tab-statistics" class="tab-content active">
            <div class="stats-header">
                <div class="period-selector">
                    <button id="prev-period" class="nav-btn">◀</button>
                    <span id="current-period">2026年1月</span>
                    <button id="next-period" class="nav-btn">▶</button>
                </div>
                <div class="view-toggle">
                    <button class="view-btn active" data-view="day" data-i18n="stats_daily">日別</button>
                    <button class="view-btn" data-view="month" data-i18n="stats_monthly">月別</button>
                </div>
            </div>

            <div class="filter-section">
                <label data-i18n="filter_label">判定機能:</label>
                <select id="blocking-filter">
                    <option value="all" data-i18n="filter_all">ON + OFF合計</option>
                    <option value="on" data-i18n="filter_on">ONの時のみ</option>
                    <option value="off" data-i18n="filter_off">OFFの時のみ</option>
                </select>
            </div>

            <!-- グラフエリア -->
            <div class="chart-container">
                <canvas id="usage-chart"></canvas>
            </div>

            <!-- 我慢回数表示 -->
            <div class="patience-stats" id="patience-section">
                <h3 data-i18n="patience_title">💪 我慢回数</h3>
                <div id="patience-count" class="stat-value">0回</div>
            </div>

            <!-- 選択された日/月の詳細 -->
            <div class="detail-section" id="detail-section">
                <h3 id="detail-title" data-i18n="detail_select_date">日付を選択してください</h3>
                <div class="detail-summary">
                    <div class="detail-stat">
                        <span class="stat-label" data-i18n="detail_total_label">閲覧時間</span>
                        <span id="detail-total" class="stat-value-small"></span>
                    </div>
                    <div class="detail-stat">
                        <span class="stat-label" data-i18n="detail_patience_label">我慢回数</span>
                        <span id="detail-patience" class="stat-value-small"></span>
                    </div>
                </div>
                <div id="detail-list" class="detail-list">
                    <!-- ドメインリストがここに表示 -->
                </div>
            </div>
        </section>

        <!-- サイト設定タブ -->
        <section id="tab-sites" class="tab-content">
            <div class="site-section">
                <h3 data-i18n="allowlist_title">✅ 許可サイト（警告なし）</h3>
                <p class="section-desc" data-i18n="allowlist_desc">ここに追加したサイトはスコア測定・警告がスキップされます</p>
                <div class="site-add">
                    <input type="text" id="allowlist-input" data-i18n-placeholder="domain_placeholder"
                        placeholder="例: example.com">
                    <button id="add-allowlist" class="btn btn-small" data-i18n="add">追加</button>
                </div>
                <ul id="allowlist" class="site-list"></ul>
            </div>

            <div class="site-section">
                <h3 data-i18n="blocklist_title">🚫 禁止サイト（完全ブロック）</h3>
                <p class="section-desc" data-i18n="blocklist_desc">ここに追加したサイトは完全にブロックされます</p>
                <div class="site-add">
                    <input type="text" id="blocklist-input" data-i18n-placeholder="domain_placeholder"
                        placeholder="例: example.com">
                    <button id="add-blocklist" class="btn btn-small" data-i18n="add">追加</button>
                </div>
                <ul id="blocklist" class="site-list"></ul>
            </div>

            <div class="site-section">
                <h3 data-i18n="pattern_title">🔗 禁止パターン（URLパス）</h3>
                <p class="section-desc" data-i18n="pattern_desc">特定のパスをブロック（例: YouTube Shorts）</p>
                <div class="site-add pattern-add">
                    <input type="text" id="pattern-domain" data-i18n-placeholder="pattern_domain_placeholder"
                        placeholder="ドメイン">
                    <input type="text" id="pattern-path" data-i18n-placeholder="pattern_path_placeholder"
                        placeholder="パス（例: /shorts）">
                    <button id="add-pattern" class="btn btn-small" data-i18n="add">追加</button>
                </div>
                <ul id="blocked-patterns" class="site-list"></ul>
            </div>
        </section>

        <!-- 詳細設定タブ (旧: 記録設定) -->
        <section id="tab-advanced" class="tab-content">
            <div class="recording-section">
                <!-- 言語設定 (最上部に配置) -->
                <div class="setting-group language-setting">
                    <h4 data-i18n="language_title">🌐 言語設定 / Language</h4>
                    <p class="section-desc" data-i18n="language_desc">表示言語を選択 / Select display language</p>
                    <div class="language-selector">
                        <select id="language-select">
                            <option value="ja">日本語</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>

                <div class="divider"></div>

                <h3 data-i18n="recording_title">📊 記録設定</h3>

                <label class="setting-item">
                    <div class="setting-info">
                        <span class="setting-title" data-i18n="setting_patience">💪 我慢回数を記録</span>
                        <span class="setting-desc" data-i18n="setting_patience_desc">警告を閉じずにページを離れた回数</span>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="setting-patience">
                        <span class="toggle-slider"></span>
                    </label>
                </label>

                <label class="setting-item">
                    <div class="setting-info">
                        <span class="setting-title" data-i18n="setting_browsing">🌐 閲覧サイト・時間を記録</span>
                        <span class="setting-desc" data-i18n="setting_browsing_desc">どのサイトをどれくらい見たか</span>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="setting-browsing">
                        <span class="toggle-slider"></span>
                    </label>
                </label>

                <label class="setting-item sub-setting" id="sns-setting">
                    <div class="setting-info">
                        <span class="setting-title" data-i18n="setting_sns_only">📱 SNSの時間だけ記録</span>
                        <span class="setting-desc" data-i18n="setting_sns_only_desc">Twitter, Instagram等のみ</span>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="setting-sns-only">
                        <span class="toggle-slider"></span>
                    </label>
                </label>

                <label class="setting-item">
                    <div class="setting-info">
                        <span class="setting-title" data-i18n="setting_debug">🔧 デバッグ情報の表示</span>
                        <span class="setting-desc" data-i18n="setting_debug_desc">ポップアップに詳細な類似度スコアを表示</span>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="setting-debug-mode">
                        <span class="toggle-slider"></span>
                    </label>
                </label>

                <div class="setting-group">
                    <h4 data-i18n="timezone_title">🌍 地域・タイムゾーン設定</h4>
                    <p class="section-desc" data-i18n="timezone_desc">グラフ表示に使用するタイムゾーンを指定</p>

                    <div class="timezone-setting">
                        <label class="radio-option">
                            <input type="radio" name="timezone-mode" value="auto" checked>
                            <span data-i18n="timezone_auto">自動検出</span>
                            <span id="auto-timezone-display" class="detected-timezone"
                                style="margin-left:8px; color:#888; font-size:0.9em;"></span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="timezone-mode" value="region">
                            <span data-i18n="timezone_region">地域から選択</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="timezone-mode" value="manual">
                            <span data-i18n="timezone_manual">手動入力 (UTCオフセット)</span>
                        </label>
                    </div>

                    <div id="timezone-region-input" class="timezone-input-area" style="display: none;">
                        <input type="text" id="timezone-region" list="timezone-list"
                            data-i18n-placeholder="timezone_region_placeholder" placeholder="地域名で検索 (例: Tokyo)">
                        <datalist id="timezone-list"></datalist>
                    </div>

                    <div id="timezone-manual-input" class="timezone-input-area" style="display: none;">
                        <input type="text" id="timezone-manual" data-i18n-placeholder="timezone_manual_placeholder"
                            placeholder="例: +09:00">
                    </div>
                </div>

                <div class="divider"></div>

                <button id="save-recording-settings" class="btn btn-primary" data-i18n="save_settings">設定を保存</button>
            </div>
        </section>

        <!-- データ管理タブ -->
        <section id="tab-data" class="tab-content">
            <div class="data-section">
                <h3 data-i18n="export_title">📤 データエクスポート</h3>
                <p class="section-desc" data-i18n="export_desc">統計データをファイルとして保存します</p>

                <div class="export-options">
                    <label class="radio-option">
                        <input type="radio" name="export-range" value="all" checked>
                        <span data-i18n="export_all_periods">すべての期間</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="export-range" value="range">
                        <span data-i18n="export_specify_range">期間を指定</span>
                    </label>
                </div>

                <div class="date-range" id="export-date-range" style="display: none;">
                    <div class="date-input">
                        <label data-i18n="export_start_date">開始日</label>
                        <input type="date" id="export-start-date">
                    </div>
                    <div class="date-input">
                        <label data-i18n="export_end_date">終了日</label>
                        <input type="date" id="export-end-date">
                    </div>
                </div>

                <div class="export-content-options">
                    <label class="checkbox-option">
                        <input type="checkbox" id="export-patience" checked>
                        <span data-i18n="export_patience_data">我慢回数データ</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" id="export-browsing" checked>
                        <span data-i18n="export_browsing_data">閲覧時間データ</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" id="export-settings" checked>
                        <span data-i18n="export_settings_data">設定（サイト設定・記録設定・勉強項目）</span>
                    </label>
                </div>

                <div class="export-buttons">
                    <button id="export-json" class="btn btn-primary" data-i18n="export_json">📦 JSONでエクスポート</button>
                    <div class="csv-export-group">
                        <button id="export-csv-browsing" class="btn btn-secondary" data-i18n="export_csv_browsing">📊
                            閲覧時間をCSV出力</button>
                        <button id="export-csv-patience" class="btn btn-secondary" data-i18n="export_csv_patience">💪
                            我慢回数をCSV出力</button>
                    </div>
                </div>
                <p class="export-hint" data-i18n="export_hint">💡 CSVはExcelでピボットテーブル/グラフ作成に最適な形式です</p>
            </div>

            <div class="data-section">
                <h3 data-i18n="import_title">📥 データインポート</h3>
                <p class="section-desc" data-i18n="import_desc">JSONファイルからデータを読み込みます</p>

                <div class="import-options">
                    <label class="radio-option">
                        <input type="radio" name="import-mode" value="merge" checked>
                        <span data-i18n="import_merge">既存データとマージ</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="import-mode" value="replace">
                        <span data-i18n="import_replace">既存データを置き換え</span>
                    </label>
                </div>

                <div class="file-input-wrapper">
                    <input type="file" id="import-file" accept=".json" style="display: none;">
                    <button id="import-select" class="btn btn-secondary" data-i18n="import_select_file">ファイルを選択</button>
                    <span id="import-filename" class="filename"></span>
                </div>

                <button id="import-data" class="btn btn-primary" disabled data-i18n="import_button">インポート</button>
            </div>

            <div class="data-section">
                <h3 data-i18n="delete_title">🗑️ データ削除</h3>
                <p class="section-desc" data-i18n="delete_desc">指定した期間のデータを削除します</p>

                <div class="date-range">
                    <div class="date-input">
                        <label data-i18n="export_start_date">開始日</label>
                        <input type="date" id="delete-start-date">
                    </div>
                    <div class="date-input">
                        <label data-i18n="export_end_date">終了日</label>
                        <input type="date" id="delete-end-date">
                    </div>
                </div>

                <button id="delete-range" class="btn btn-danger" data-i18n="delete_range">選択期間を削除</button>

                <div class="divider"></div>

                <button id="delete-all" class="btn btn-danger-outline" data-i18n="delete_all">すべてのデータを削除</button>
            </div>
        </section>
    </div>

    <script src="i18n.js"></script>
    <script src="chart.js"></script>
    <script src="statistics-storage.js"></script>
    <script src="settings.js"></script>
</body>

</html>