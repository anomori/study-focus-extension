# Study Focus Guard (勉強脱線防止拡張機能)

勉強中にYouTubeやSNSなどの誘惑に負けないためのChrome拡張機能です。
閲覧中のページが「勉強に関連しているか」をAIがリアルタイムで判定し、無関係なコンテンツには警告を表示します。YouTube ShortsやInstagramは強制的にブロックされます。

## ✨ 機能

### 🤖 AIによる関連性判定
- 登録した勉強内容（例: "Programming", "Math"）と閲覧中のページの意味的な関連性を判定
- **Transformers.js (MiniLM-L12)** を使用し、ブラウザ内で完結するローカル推論（プライバシー重視）
- 学習系コンテンツ（YouTubeの教育カテゴリなど）はスコア優遇
- **30秒ごとの定期判定**で常時監視

### 🚫 完全ブロック（カスタマイズ可能）
- **YouTube Shorts** (`youtube.com/shorts/`) - デフォルトでブロック
- **Instagram** (`instagram.com`) - デフォルトでブロック
- **カスタム禁止サイト**: 詳細設定から自由に追加可能
- **許可サイト**: 禁止より優先、スコア測定・警告をスキップ

### ⚠️ 脱線警告
- **警告オーバーレイ**: 類似度が低い場合、"🥺" キャラクターと共に「勉強に関係ありますか？」と警告
- **再判定機能**: 警告を閉じても**2分後に再チェック**し、まだ脱線していれば再度警告
- **Twitter/X補正**: ホームタイムラインは追加ペナルティで厳しく判定

### 📊 統計機能（任意）
- **我慢回数**: 警告を閉じずにページを離れた回数を記録
- **閲覧時間**: どのサイトをどれくらい見たかを記録
- **グラフ表示**: 日別・月別の棒グラフ（クリックで詳細な時間・回数を確認可能）
- **判定ON/OFF別フィルター**: ONの時/OFFの時/合計で切り替え可能
- **タイムゾーン対応**: 自動検出や手動設定で、海外でも現地の時間で集計可能
- **プライバシー重視**: すべてローカル保存、データ削除も可能

### 🎛️ コントロール機能
- **拡張機能ON/OFF**: ポップアップからワンクリックで一時無効化
- **トピックON/OFF**: 各勉強内容を個別に有効/無効切替可能
- **スコア表示**: ポップアップで現在のページの判定スコアをリアルタイム表示
- **詳細設定**: サイト設定・記録設定・統計閲覧・データ管理

## 🚀 インストール方法

この拡張機能はストア公開されていないため、開発者モードで読み込みます。

1. このリポジトリをZIPでダウンロードし、解凍します。
   - または `git clone` します。
2. Chromeを開き、アドレスバーに `chrome://extensions/` と入力します。
3. 右上の **「デベロッパー モード」** をONにします。
4. **「パッケージ化されていない拡張機能を読み込む」** をクリックします。
5. 解凍したフォルダ（`manifest.json` があるフォルダ）を選択します。

## 📖 使い方

1. **勉強内容を登録する**:
   - 拡張機能のアイコンをクリックし、ポップアップを開きます。
   - 勉強するトピックを入力して「追加」します（例: `English`, `React`, `線形代数`）。
   - 各トピックはON/OFFトグルで有効/無効を切り替えられます。

2. **勉強を始める**:
   - YouTubeやWebページを閲覧します。
   - 勉強と無関係なページを開くと、画面が警告で覆われます。
   - 本当に勉強に必要な場合は「関係ある（閉じる）」を押して続行できます（2分後に再チェック）。

3. **一時的に無効化する**:
   - ポップアップの「判定・ブロック機能」トグルをOFFにすると、全ての判定が停止します。

4. **詳細設定を使う**:
   - ポップアップの「詳細設定・統計を見る」ボタンをクリック。
   - **サイト設定**: 許可サイト・禁止サイトを自由に追加/削除。
   - **記録設定**: 我慢回数・閲覧時間の記録ON/OFFを切り替え。
   - **統計**: 日別/月別のグラフで閲覧時間を確認。棒をクリックで詳細表示。
   - **データ管理**: 不要なデータを期間指定で削除。

## 🛠 技術的な仕組み

| コンポーネント | 役割 |
|--------------|------|
| `content.js` | ページ情報の取得、DOM操作（オーバーレイ表示）、定期判定、我慢イベント検出 |
| `background.js` | オフスクリーンAPI制御、タブごとのスコア管理、閲覧セッション追跡 |
| `offscreen.js` | サンドボックスとの通信ブリッジ |
| `sandbox.js` | AIモデルの実行環境（Wasm制約の回避） |
| `popup.html/js` | ユーザーインターフェース |
| `settings.html/js` | 詳細設定・統計画面 |
| `statistics-storage.js` | 統計データの保存・取得・削除 |

**Embedding Model**: `Xenova/paraphrase-multilingual-MiniLM-L12-v2` (約20MB、50以上の言語に対応)
**Chart Library**: Chart.js (グラフ表示用)
