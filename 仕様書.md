## 📋 仕様書：学習集中Chrome拡張

### コンセプト

勉強する項目を登録し、閲覧中のコンテンツが**意味的に関連しているか**を**AI（Transformers.js）**で判定。関連しなければ**邪魔する広告**のような警告画面で妨害し、YouTube Shortsなどの明らかな脱線コンテンツは**完全ブロック**する。

---

### 機能一覧

| 機能 | 説明 |
| --- | --- |
| **勉強項目の登録** | ユーザーが「英語の勉強」「レポート作成」などを登録。**自動類語展開**（例: program → coding, algorithm）により、関連語もカバー。 |
| **文脈解析** | ページタイトル、H1、meta description、さらに**YouTubeの隠しメタデータ（ジャンル、詳細説明）**を取得して解析。 |
| **ベクトル類似度判定** | **Transformers.js (MiniLM-L12)** を使用し、登録項目と閲覧内容の意味的な関連性をスコアリング。 |
| **学習モード判定** | 「教育（Education）」「科学（Science）」などのカテゴリ、またはキーワード一致で**スコアボーナス**を付与。逆にSNS等はペナルティ。 |
| **邪魔する広告** | 関連性が低い（スコア < 0.35）場合、"🥺"などのキャラクターと共に警告オーバーレイを表示し、再確認を促す。 |
| **ショート動画ブロック** | YouTube Shorts（[`youtube.com/shorts/`](http://youtube.com/shorts/)）を検知し、即座に黒画面で完全ブロック不可避にする。 |

---

### 技術スタック

| 項目 | 技術 |
| --- | --- |
| プラットフォーム | Chrome拡張機能（Manifest V3） |
| 言語 | HTML / CSS / JavaScript |
| ベクトル埋め込み | **Transformers.js** + **Xenova/paraphrase-multilingual-MiniLM-L12-v2** |
| サンドボックス | `sandbox` ページ内でWasm版ONNX Runtimeを実行（CSP制限回避のため） |
| データ保存 | Chrome Storage API |

---

### 処理フロー

```
1. ユーザーが勉強項目を登録（例: "Math"）
2. ページ遷移 or URL変更を検知
   - URLが [youtube.com/shorts/] → 即ブロック (Shorts Blocked)
3. ページの情報を収集
   - タイトル + H1 + Meta Description
   - YouTube json-ld (Genre, Description)
4. Offscreen/Sandboxでベクトル化＆類似度計算 (Transformers.js)
   - ベーススコア算出（コサイン類似度）
   - ボーナス: キーワード一致 (+0.5), 教育カテゴリ (+0.3)
   - ペナルティ: SNSドメイン (-0.2)
5. 最終スコア < 0.35 (閾値) → 邪魔するオーバーレイを表示
   - 「勉強に関係ありますか？」と問いかけ
```

---

### 邪魔する広告（警告）の仕様

- **オーバーレイ**: 画面下部に固定などではなく、コンテンツを覆う形で警告を表示。
- **メッセージ**: 「類似度スコア: 0.15 (判定: 低)」「登録された勉強内容と関連が薄い可能性があります。」
- **解除**: 「関係ある（閉じる）」ボタンでのみ解除可能（能動的な意思表示が必要）。
- **デバッグ**: 画面右下に現在のスコアと判定結果（OK/BLOCK）を常時表示。

---

### 補足：AIモデルについて

**Transformers.js + Xenova/paraphrase-multilingual-MiniLM-L12-v2** を使用：

- **多言語対応**: 日本語、英語など50以上の言語を同一ベクトル空間にマッピング可能。
- **高精度**: 単なる単語一致ではなく、文脈的な意味の近さを判定。
- **完全ローカル**: 外部API（OpenAI等）は一切使用せず、ブラウザ内ですべて完結。プライバシーも安全。